<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
	<title></title>
	<link rel="stylesheet" href="meastyle.css">
	<script type="text/javascript" src="meascript.js"></script>
	<script type="text/javascript" src="app.js"></script>
	<script type="text/javascript" src="PastePerfect.js"></script>
	
	</head>
	<body id="bbb">
		</div>	
		
<div class="content">
<input type="button" id="Slide_Button" class="MainSlideBut" value="" onclick="openNav(); toggle(this);">

		<div id="mySidenav" class="sidenav">
 
<label for="fileDialog" class="menu_btA">Écrire</label>
<input id="fileDialog" type="file" class="input-file" nwsaveas="Sans titre.txt">



<label for="file" class="menu_btB">Lire</label>
<input id="file" class="input-file"type="file" onclick="chooseFile('#file')"/>
<input type="button" id="1" class="menu_bt" value="Nouveau" onclick="openNavSave2();">

<input type="button" id="2" class="menu_bt" value="Traduire" onclick="openNavIO();">
<input type="button" id="3" class="menu_bt" value="Génétique" onclick="openNavGe();">
<!-- <input type="button" id="1" class="menu_bt" value="Bibliographie" onclick="ShowBibFile();"> -->
<input type="button" id="4" class="menu_bt" value="Coller" onclick="openNavPast();">
<input type="button" id="6" class="menu_bt" value="Notes" onclick="openNotes();">
<input type="button" id="5b" class="menu_bt" value="Présentation" onclick="openNavPre();">


<input type="button" id="7b" class="menu_btV" value="Variables" onclick="open_para();">

</div>

<div id="mySidenavIO" class="sidenav">
<input type="button" id="IOBUT" class="IoSlideBut" onclick="closeNavIO()">
<input type="button" id="8" class="menu_btA" value="Docx" onclick="GenDocx();">
<input type="button" id="9" class="menu_bt" value="Pdf" onclick="GenPdf();">
<input type="button" id="10" class="menu_bt" value="Pptx" onclick="GenSlide();">
<input type="button" id="11" class="menu_bt" value="PdfNote" onclick="GenPdfFusion();">
<input type="button" id="11b" class="menu_bt" value="DocxNote" onclick="GenDocxFusion();">
<input type="button" id="11C" class="menu_bt" value="Epub" onclick="Epub();">
<label for="file2" class="menu_btB">Réécrire</label>
<input id="file2" class="input-file2"type="file" onclick="Importdocx('#file')"/>

<span id="ShowTerm" class="term"></span>
</div>
<div id="mySidenavGe" class="sidenav">
<input type="button" id="GENBUT" class="GenSlideBut" onclick="closeNavGe()">
<input type="button" id="12" class="menu_btA" value="Addere" onclick="GitAdd();">
<input type="button" id="13" class="menu_bt" value="Committere" onclick="GitCommit();">
<input type="button" id="14" class="menu_bt" value="Meminisse" onclick="GitLog();">
<span id="ShowTermGen" class="term"></span>
</div>


</div>
<div id="mySidenavPre" class="sidenav">
<input type="button" id="PREBUT" class="PreSlideBut" onclick="toggle3();">
<span id="toogle">
  <input type="button" id="5" class="menu_btA" value="Chante" onclick="toggle2();">
  </span>
  <input type="button" id="20" class="menu_bt" value="Édition" onclick="closeNavPre();">
	<span class="linePre">
    <span class="time" id="difference"></span><span class="time" id="space">&nbsp;-&nbsp;</span>
    <span class="time" id="timeC"></span>
<label for="taille"class="menu_btpre" id="emlab">Taille</label>	
<input type="range" id="em" min="1" value="5" max="10" step="0.5" oninput="outputTaille(value)">
	<output for="taille" id="taillelevel">0</output>
	
<label for="vitesse" class="menu_btpre" id="speedlab">Vitesse</label>
<input type="range" id="speed" min="1" value=VitesseRouleau max="100" step="1" oninput="outputTachios(value)">
	<output for="vitesse" id="speedlevel">0</output>
	</span>
	
</div>
	

<div id="mySidenavPast" class="sidenav">
<input type="button" id="PASTBUT" class="PastSlideBut" onclick="closeNavPast()">
<input type="button" id="15" class="menu_btA" value="Note" onclick="document.getElementById('editor').focus(); pasteHtmlAtCaret(Note); ">
<input type="button" id="15" class="menu_bt" value="YAML" onclick="document.getElementById('editor').focus(); pasteHtmlAtCaret(YAML); ">
<input type="button" id="16" class="menu_bt" value="Slide" onclick="document.getElementById('editor').focus(); pasteHtmlAtCaret(Slide); ">
<input type="button" id="17" class="menu_bt" value="Lorem" onclick="document.getElementById('editor').focus(); pasteHtmlAtCaret(Lorem); ">
</div>

<div id="mySidenavSave" class="sidenav">
<input type="button" id="SAVEBUT" class="SaveSlideBut" onclick="closeNavSav()">

<label for="folderinput2" class="label-file">Répertoire</label>
<input class="label-file" type="file" id="folderinput2" nwdirectory>
<input type="text" class="inputnav" id="TempSaveNameInput">
<input type="button"class="menu_bt" autofocus value="Écrire" onclick="SaveMe()">
</div>
<div id="mySidenavSave2" class="sidenav">
  <input type="button" id="SAVEBUT2" class="SaveSlideBut2" onclick="closeNavSav2()">
  
  <label for="folderinput3" class="label-file">Répertoire</label>
  <input class="label-file" type="file" id="folderinput3" nwdirectory>
  <input type="text" class="inputnav" id="TempSaveNameInput2">
  <input type="button"class="menu_bt" autofocus value="Écrire" onclick="LiberNovi()">
  </div>




		<div id="editor" contenteditable="true">
  <p id="WISINWYG">
	 
      </p>
      
</div>

<script>

if (localStorage.getItem("Time") == "true") {
       document.getElementById("timeC").style.display = "inline";
     }
     else {
       document.getElementById("timeC").style.display = "none";
     }
     if (localStorage.getItem("TimeR") == "true") {
       document.getElementById("difference").style.display = "inline";
     }
     else {
       document.getElementById("difference").style.display = "none";
     }
     if (localStorage.getItem("Time") && localStorage.getItem("TimeR") == "true") {
       document.getElementById("space").style.display = "inline";
     }
     else {
       document.getElementById("space").style.display = "none";
     }
    if (localStorage.getItem("checkspeedcook") == "true") {
   document.getElementById("speed").style.display = "inline";
       document.getElementById("speedlab").style.display = "inline";
     }
    else {
      document.getElementById("speed").style.display = "none";
      document.getElementById("speedlab").style.display = "none";
     }
     if (localStorage.getItem("checksizecook") == "true") {
      document.getElementById("em").style.display = "inline";
       document.getElementById("emlab").style.display = "inline";
     }
     else {
       document.getElementById("em").style.display = "none";
      document.getElementById("emlab").style.display = "none";
  }
  

nw.Window.get().on('focus', function() {
  //console.log("la fenêtre de note est focus")
  var shortcut = new nw.Shortcut(ShortSave);
    nw.App.registerGlobalHotKey(shortcut);
    var shortcut2 = new nw.Shortcut(ShortNote);
    nw.App.registerGlobalHotKey(shortcut2);
    var shortcut3 = new nw.Shortcut(ShortPast);
    nw.App.registerGlobalHotKey(shortcut3);	
    var shortcut4 = new nw.Shortcut(ShortNoteMean);
    nw.App.registerGlobalHotKey(shortcut4);
  });
  nw.Window.get().on('blur', function() {
  //console.log("la fenêtre de note est pas focus")
  var shortcut = new nw.Shortcut(ShortSave);
    nw.App.unregisterGlobalHotKey(shortcut);
    var shortcut2 = new nw.Shortcut(ShortNote);
    nw.App.unregisterGlobalHotKey(shortcut2);
    var shortcut3 = new nw.Shortcut(ShortPast);
    nw.App.unregisterGlobalHotKey(shortcut3);	
    var shortcut4 = new nw.Shortcut(ShortNoteMean);
    nw.App.unregisterGlobalHotKey(shortcut4);
  });
	
		document.querySelector("#folderinput2")
     .addEventListener("change", function() {
       var folderPath = this.value;   
       localStorage.removeItem("TempFolderPath");
    localStorage.setItem("TempFolderPath", folderPath);  
     }); 

     document.querySelector("#folderinput3")
     .addEventListener("change", function() {
       var folderPath = this.value;   
       localStorage.removeItem("FilePathCook");
    localStorage.setItem("FilePathCook", folderPath);  
     });


function SaveMe(){
	     localStorage.removeItem("TempFilName");
	var TempFilVar = document.getElementById("TempSaveNameInput").value;
    localStorage.setItem("TempFilName", TempFilVar); 	
    
    
	     saveHopeT2();
	     closeNavSav();
     }


     function LiberNovi(){
      
       localStorage.removeItem("InputFile");
       localStorage.removeItem("CaretPosition");
	var TempFilVar = document.getElementById("TempSaveNameInput2").value;
    localStorage.setItem("InputFile", TempFilVar); 	
    CleanSlate();
	     saveHopeT3();
       closeNavSav2();
       
     }

function CleanSlate(){
  var path = require("path");	            
  var fs = require("fs");
  var text_to_save ="";
 var namedata2write = "temp_rest";
fs.writeFile(namedata2write, text_to_save, (err) => {  
       if (err) throw err;
});
var shortcut = new nw.Shortcut(ShortSave);
nw.App.unregisterGlobalHotKey(shortcut);
var shortcut2 = new nw.Shortcut(ShortNote);
nw.App.unregisterGlobalHotKey(shortcut2);
var shortcut3 = new nw.Shortcut(ShortPast);
nw.App.unregisterGlobalHotKey(shortcut3);	
var shortcut4 = new nw.Shortcut(ShortNoteMean);
nw.App.unregisterGlobalHotKey(shortcut4);
	window.location.reload();
 
	fs.readFile("temp_rest", function (err, data) {
  if (err) throw err;
  document.getElementById("editor").innerText = data;

}); 


}



var VitesseRouleau = localStorage.getItem("tachios");
	
	function TournRouleau() {
	var canto = document.getElementById("editor");
    window.scrollBy(1, 1);
    scrolldelay = setTimeout(TournRouleau,VitesseRouleau);
    
     }

function PauseRouleau() {
  //scrolldelay = setTimeout(TournRouleau,VitesseRouleau);
	clearTimeout(scrolldelay);
}
		function toggle2()
		
            { //event.keyCode == 32;
              if(document.getElementById("5").value=="Pause")
              {
               document.getElementById("5").value="Chante";
               PauseRouleau();
               stasis();
                             }
              else
              {
                document.getElementById("5").value="Pause";
                TournRouleau();
                actio();
              }
            }


            
    function toggle3(button)
            {
              if(document.getElementById("PREBUT").value=="1")
              {
               document.getElementById("PREBUT").value="2";
               document.getElementById("mySidenavPre").style.width = "100%";
               document.getElementById("mySidenav").style.width = "100%";
               document.getElementById("mySidenavPre").style.height = "50px";
               document.getElementById("mySidenav").style.height = "50px";
              
                             }
              else
              {
                document.getElementById("PREBUT").value="1";
                
                document.getElementById("mySidenavPre").style.width = "0%";
               document.getElementById("mySidenav").style.width = "0%";
               document.getElementById("mySidenavPre").style.height = "50px";
               document.getElementById("mySidenav").style.height = "50px";
              }
            }	 
            var d1 = new Date();
d1.setHours(0,0,0);

var Momentum = 0;

function tempus_fugit(){
    var h= d1.getHours();
    var m= d1.getMinutes();
    var s=d1.getSeconds();
    m= (m<10)?"0"+m: m;
    s= (s<10)? "0"+s : s;
    
    //var el= document.getElementById("inputid");
    //el.value=
    document.getElementById("difference").innerHTML =  h+":"+m+":"+s;
    d1.setSeconds(d1.getSeconds()+1);
    if( h==0 && m==0 && s==0 ) clearTimeout(Momentum)
    Momentum= setTimeout(tempus_fugit,1000);
}

function stasis(){
    clearTimeout(Momentum);
    
}


function actio(){
    Momentum= setTimeout(tempus_fugit,1000);
    
}
  
 

 window.onunload = function(){
  SaveCaretEP();
	     if (localStorage.getItem("OpenStartCook")== "false"){
        localStorage.removeItem("InputFile");
        localStorage.removeItem("CaretPosition");
        localStorage.removeItem("CaretPositionN");	 
	  }
    else if (localStorage.getItem("OpenStartCook")== null){
        localStorage.removeItem("InputFile");
        localStorage.removeItem("CaretPosition");
        localStorage.removeItem("CaretPositionN");	 
	  }

      if (localStorage.getItem("check_out_s") == "true")
      
	{ function delay(ms) {
    var start = +new Date;
    while ((+new Date - start) < ms);
}
 
delay(1500);

saveNullExit();
	  
  }
  
  App.closeAllWindows()
  	  
		}
    window.onload = function() {
     // document.getElementById("editor").scrollTo(1000, 500);
     
window.addEventListener("storage", refresh);	
document.getElementById("editor").style.textAlign = localStorage.getItem("align_s");
document.getElementById("editor").style.color = localStorage.getItem("color_s");
document.getElementById("editor").style.lineHeight = localStorage.getItem("inter_s");
document.getElementById("editor").style.textIndent = localStorage.getItem("indent_s");
document.getElementById("editor").style.fontWeight = localStorage.getItem("bold_s");
document.getElementById("editor").style.fontStyle = localStorage.getItem("ital_s");
document.getElementById("editor").style.textDecoration = localStorage.getItem("deco_s");
document.getElementById("editor").style.fontFamily = localStorage.getItem("font_s");
document.getElementById("editor").style.fontSize = localStorage.getItem("size_s");
document.getElementById("editor").style.backgroundColor = localStorage.getItem("colorf_s");
document.getElementById("bbb").style.backgroundColor = localStorage.getItem("colorf_s2");
document.getElementById("editor").style.zoom = localStorage.getItem("zoom_s");

var fs = require("fs");	
  var path = require("path");	            
	fs.readFile("temp_rest", function (err, data) {
  if (err) throw err;
  console.log(data);
  document.getElementById("editor").innerText = data;
  openGO();
}); 

}	
	
	function refresh(event) {
	var fs = require("fs");
	var gui = require("nw.gui");
	var path = require('path');
	var namedata2write = "temp_rest";	
		
var text_to_save = document.getElementById("editor").innerText;
fs.writeFile(namedata2write, text_to_save, (err) => {  
       if (err) throw err;
});
var shortcut = new nw.Shortcut(ShortSave);
nw.App.unregisterGlobalHotKey(shortcut);
var shortcut2 = new nw.Shortcut(ShortNote);
nw.App.unregisterGlobalHotKey(shortcut2);
var shortcut3 = new nw.Shortcut(ShortPast);
nw.App.unregisterGlobalHotKey(shortcut3);	
var shortcut4 = new nw.Shortcut(ShortNoteMean);
nw.App.unregisterGlobalHotKey(shortcut4);
	window.location.reload();
  
        
	}
	

var fs = require("fs");
var gui = require("nw.gui");


function Fenetre(){
nw.Window.open('index.html', {title: 'bob'}, function(new_win) {
  
});
}
	        
   function FileDialog(inputId, callback) {
	   
	        var fd = this;
     fd.chooser = document.querySelector(inputId);
     fd.chooser.addEventListener("change", function() {
       var path = this.value;
       callback(path);
       fd.chooser.value = '';
     });
     fd.open = function () {
       fd.chooser.click();
     };
return fd; }
   var myFileDialog = new FileDialog('#fileDialog', function (path) {
	   var doc_to_save = document.getElementById("editor").innerText;	
     fs.writeFile (path, doc_to_save, 'utf8', (err) => {  
    if (err) throw err;
    console.log('text enregistré');
});
     console.log(path);
   });
   
</script>
</body>
</html>

